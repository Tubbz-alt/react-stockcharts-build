{"version":3,"sources":["../../../src/lib/series/CandlestickSeries.js"],"names":["CandlestickSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","className","wickClassName","candleClassName","xScale","yScale","chartConfig","plotData","xAccessor","candleData","getCandleData","getWicksSVG","getCandlesSVG","clip","propTypes","string","widthRatio","number","width","oneOfType","func","classNames","fill","stroke","wickStroke","yAccessor","bool","defaultProps","open","d","high","low","close","candleStrokeWidth","opacity","wicks","map","each","idx","wick","x","y1","y2","y3","y4","candles","y","height","offset","wickNest","key","entries","lineCap","lineJoin","forEach","outer","values","strokeStyle","fillStyle","fillRect","candleNest","strokeKey","strokeValues","lineWidth","inner","strokeRect","wickStrokeProp","fillProp","strokeProp","widthFunctor","trueOffset","i","length","Math","round","ohlc","max","abs","push","direction"],"mappings":"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","file":"CandlestickSeries.js","sourcesContent":["\n\nimport { nest } from \"d3-collection\";\n\nimport React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\n\nimport GenericChartComponent from \"../GenericChartComponent\";\nimport { getAxisCanvas } from \"../GenericComponent\";\n\nimport {\n\thexToRGBA, isDefined, functor, plotDataLengthBarWidth, head\n} from \"../utils\";\n\nclass CandlestickSeries extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.renderSVG = this.renderSVG.bind(this);\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\n\t}\n\tdrawOnCanvas(ctx, moreProps) {\n\t\tdrawOnCanvas(ctx, this.props, moreProps);\n\t}\n\trenderSVG(moreProps) {\n\t\tconst { className, wickClassName, candleClassName } = this.props;\n\t\tconst { xScale, chartConfig: { yScale }, plotData, xAccessor } = moreProps;\n\n\t\tconst candleData = getCandleData(this.props, xAccessor, xScale, yScale, plotData);\n\n\t\treturn <g className={className}>\n\t\t\t<g className={wickClassName} key=\"wicks\">\n\t\t\t\t{getWicksSVG(candleData)}\n\t\t\t</g>\n\t\t\t<g className={candleClassName} key=\"candles\">\n\t\t\t\t{getCandlesSVG(this.props, candleData)}\n\t\t\t</g>\n\t\t</g>;\n\t}\n\n\trender() {\n\t\tconst { clip } = this.props;\n\t\treturn <GenericChartComponent\n\t\t\tclip={clip}\n\t\t\tsvgDraw={this.renderSVG}\n\t\t\tcanvasDraw={this.drawOnCanvas}\n\t\t\tcanvasToDraw={getAxisCanvas}\n\t\t\tdrawOn={[\"pan\"]}\n\t\t/>;\n\t}\n}\n\nCandlestickSeries.propTypes = {\n\tclassName: PropTypes.string,\n\twickClassName: PropTypes.string,\n\tcandleClassName: PropTypes.string,\n\twidthRatio: PropTypes.number,\n\twidth: PropTypes.oneOfType([\n\t\tPropTypes.number,\n\t\tPropTypes.func\n\t]),\n\tclassNames: PropTypes.oneOfType([\n\t\tPropTypes.func,\n\t\tPropTypes.string\n\t]),\n\tfill: PropTypes.oneOfType([\n\t\tPropTypes.func,\n\t\tPropTypes.string\n\t]),\n\tstroke: PropTypes.oneOfType([\n\t\tPropTypes.func,\n\t\tPropTypes.string\n\t]),\n\twickStroke: PropTypes.oneOfType([\n\t\tPropTypes.func,\n\t\tPropTypes.string\n\t]),\n\tyAccessor: PropTypes.func,\n\tclip: PropTypes.bool,\n};\n\nCandlestickSeries.defaultProps = {\n\tclassName: \"react-stockcharts-candlestick\",\n\twickClassName: \"react-stockcharts-candlestick-wick\",\n\tcandleClassName: \"react-stockcharts-candlestick-candle\",\n\tyAccessor: d => ({ open: d.open, high: d.high, low: d.low, close: d.close }),\n\tclassNames: d => d.close > d.open ? \"up\" : \"down\",\n\twidth: plotDataLengthBarWidth,\n\twickStroke: \"#000000\",\n\t// wickStroke: d => d.close > d.open ? \"#6BA583\" : \"#FF0000\",\n\tfill: d => d.close > d.open ? \"#6BA583\" : \"#FF0000\",\n\t// stroke: d => d.close > d.open ? \"#6BA583\" : \"#FF0000\",\n\tstroke: \"#000000\",\n\tcandleStrokeWidth: 0.5,\n\t// stroke: \"none\",\n\twidthRatio: 0.8,\n\topacity: 0.5,\n\tclip: true,\n};\n\nfunction getWicksSVG(candleData) {\n\n\tconst wicks = candleData\n\t\t.map((each, idx) => {\n\t\t\tconst d = each.wick;\n\t\t\treturn <path key={idx}\n\t\t\t\tclassName={each.className}\n\t\t\t\tstroke={d.stroke}\n\t\t\t\td={`M${d.x},${d.y1} L${d.x},${d.y2} M${d.x},${d.y3} L${d.x},${d.y4}`} />;\n\t\t});\n\n\treturn wicks;\n}\n\nfunction getCandlesSVG(props, candleData) {\n\n\t/* eslint-disable react/prop-types */\n\tconst { opacity, candleStrokeWidth } = props;\n\t/* eslint-enable react/prop-types */\n\n\tconst candles = candleData.map((d, idx) => {\n\t\tif (d.width <= 1)\n\t\t\treturn (\n\t\t\t\t<line className={d.className} key={idx}\n\t\t\t\t\tx1={d.x} y1={d.y} x2={d.x} y2={d.y + d.height}\n\t\t\t\t\tstroke={d.fill} />\n\t\t\t);\n\t\telse if (d.height === 0)\n\t\t\treturn (\n\t\t\t\t<line key={idx}\n\t\t\t\t\tx1={d.x} y1={d.y} x2={d.x + d.width} y2={d.y + d.height}\n\t\t\t\t\tstroke={d.fill} />\n\t\t\t);\n\t\treturn (\n\t\t\t<rect key={idx} className={d.className}\n\t\t\t\tfillOpacity={opacity}\n\t\t\t\tx={d.x} y={d.y} width={d.width} height={d.height}\n\t\t\t\tfill={d.fill} stroke={d.stroke} strokeWidth={candleStrokeWidth} />\n\t\t);\n\t});\n\treturn candles;\n}\n\nfunction drawOnCanvas(ctx, props, moreProps) {\n\tconst { opacity, candleStrokeWidth } = props;\n\tconst { xScale, chartConfig: { yScale }, plotData, xAccessor } = moreProps;\n\n\t// const wickData = getWickData(props, xAccessor, xScale, yScale, plotData);\n\tconst candleData = getCandleData(props, xAccessor, xScale, yScale, plotData);\n\n\tconst offset = candleStrokeWidth / 2;\n\tconst wickNest = nest()\n\t\t.key(d => d.wick.stroke)\n\t\t.entries(candleData);\n\n\tctx.lineCap = \"round\";\n\tctx.lineJoin = \"round\";\n\n\twickNest.forEach(outer => {\n\t\tconst { key, values } = outer;\n\t\tctx.strokeStyle = key;\n\t\tctx.fillStyle = key;\n\n\t\tvalues.forEach(each => {\n\t\t\t/*\n\t\t\tctx.moveTo(d.x, d.y1);\n\t\t\tctx.lineTo(d.x, d.y2);\n\n\t\t\tctx.beginPath();\n\t\t\tctx.moveTo(d.x, d.y3);\n\t\t\tctx.lineTo(d.x, d.y4);\n\t\t\tctx.stroke(); */\n\t\t\tconst d = each.wick;\n\n\t\t\tctx.fillRect(d.x - offset, d.y1, candleStrokeWidth, d.y2 - d.y1);\n\t\t\tctx.fillRect(d.x - offset, d.y3, candleStrokeWidth, d.y4 - d.y3);\n\t\t});\n\t});\n\n\t// const candleData = getCandleData(props, xAccessor, xScale, yScale, plotData);\n\n\tconst candleNest = nest()\n\t\t.key(d => d.stroke)\n\t\t.key(d => d.fill)\n\t\t.entries(candleData);\n\n\n\tcandleNest.forEach(outer => {\n\t\tconst { key: strokeKey, values: strokeValues } = outer;\n\t\tif (strokeKey !== \"none\") {\n\t\t\tctx.strokeStyle = strokeKey;\n\t\t\tctx.lineWidth = candleStrokeWidth;\n\t\t}\n\t\tstrokeValues.forEach(inner => {\n\t\t\tconst { key, values } = inner;\n\t\t\tconst fillStyle = head(values).width <= 1\n\t\t\t\t? key\n\t\t\t\t: hexToRGBA(key, opacity);\n\t\t\tctx.fillStyle = fillStyle;\n\n\t\t\tvalues.forEach(d => {\n\t\t\t\tif (d.height === 0) {\n\t\t\t\t\t// <line key={idx} x1={d.x} y1={d.y} x2={d.x + d.width} y2={d.y + d.height} />\n\t\t\t\t\t/*\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.moveTo(d.x, d.y);\n\t\t\t\t\tctx.lineTo(d.x + d.width, d.y + d.height);\n\t\t\t\t\tctx.stroke();\n\t\t\t\t\t*/\n\t\t\t\t\tctx.fillRect(d.x, d.y - 0.5, d.width, 1);\n\t\t\t\t} else {\n\t\t\t\t\t/*\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.rect(d.x, d.y, d.width, d.height);\n\t\t\t\t\tctx.closePath();\n\t\t\t\t\tctx.fill();\n\t\t\t\t\tif (strokeKey !== \"none\") ctx.stroke();\n\t\t\t\t\t*/\n\t\t\t\t\tctx.fillRect(d.x, d.y, d.width, d.height);\n\t\t\t\t\tif (strokeKey !== \"none\") ctx.strokeRect(d.x, d.y, d.width, d.height);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t});\n}\n/*\nfunction getWickData(props, xAccessor, xScale, yScale, plotData) {\n\n\tconst { classNames: classNameProp, wickStroke: wickStrokeProp, yAccessor } = props;\n\tconst wickStroke = functor(wickStrokeProp);\n\tconst className = functor(classNameProp);\n\tconst wickData = plotData\n\t\t\t.filter(d => isDefined(yAccessor(d).close))\n\t\t\t.map(d => {\n\t\t\t\t// console.log(yAccessor);\n\t\t\t\tconst ohlc = yAccessor(d);\n\n\t\t\t\tconst x = Math.round(xScale(xAccessor(d))),\n\t\t\t\t\ty1 = yScale(ohlc.high),\n\t\t\t\t\ty2 = yScale(Math.max(ohlc.open, ohlc.close)),\n\t\t\t\t\ty3 = yScale(Math.min(ohlc.open, ohlc.close)),\n\t\t\t\t\ty4 = yScale(ohlc.low);\n\n\t\t\t\treturn {\n\t\t\t\t\tx,\n\t\t\t\t\ty1,\n\t\t\t\t\ty2,\n\t\t\t\t\ty3,\n\t\t\t\t\ty4,\n\t\t\t\t\tclassName: className(ohlc),\n\t\t\t\t\tdirection: (ohlc.close - ohlc.open),\n\t\t\t\t\tstroke: wickStroke(ohlc),\n\t\t\t\t};\n\t\t\t});\n\treturn wickData;\n}\n*/\n\nfunction getCandleData(props, xAccessor, xScale, yScale, plotData) {\n\n\tconst { wickStroke: wickStrokeProp } = props;\n\tconst wickStroke = functor(wickStrokeProp);\n\n\tconst { classNames, fill: fillProp, stroke: strokeProp, yAccessor } = props;\n\tconst className = functor(classNames);\n\n\tconst fill = functor(fillProp);\n\tconst stroke = functor(strokeProp);\n\n\tconst widthFunctor = functor(props.width);\n\tconst width = widthFunctor(props, {\n\t\txScale,\n\t\txAccessor,\n\t\tplotData\n\t});\n\n\t/*\n\tconst candleWidth = Math.round(width);\n\tconst offset = Math.round(candleWidth === 1 ? 0 : 0.5 * width);\n\t*/\n\tconst trueOffset = 0.5 * width;\n\n\t/*\n    const offset = trueOffset > 0.7\n\t\t? Math.round(trueOffset)\n\t\t: Math.floor(trueOffset);\n    */\n\n\t// eslint-disable-next-line prefer-const\n\tlet candles = [];\n\n\tfor (let i = 0; i < plotData.length; i++) {\n\t\tconst d = plotData[i];\n\t\tif (isDefined(yAccessor(d).close)) {\n\t\t\tconst x = Math.round(xScale(xAccessor(d)));\n\t\t\t// const x = Math.round(xScale(xAccessor(d)) - offset);\n\n\t\t\tconst ohlc = yAccessor(d);\n\t\t\tconst y = Math.round(yScale(Math.max(ohlc.open, ohlc.close)));\n\t\t\tconst height = Math.round(Math.abs(yScale(ohlc.open) - yScale(ohlc.close)));\n\n\t\t\tcandles.push({\n\t\t\t\t// type: \"line\"\n\t\t\t\tx: x - trueOffset,\n\t\t\t\ty: y,\n\t\t\t\twick: {\n\t\t\t\t\tstroke: wickStroke(ohlc),\n\t\t\t\t\tx: x,\n\t\t\t\t\ty1: Math.round(yScale(ohlc.high)),\n\t\t\t\t\ty2: y,\n\t\t\t\t\ty3: y + height, // Math.round(yScale(Math.min(ohlc.open, ohlc.close))),\n\t\t\t\t\ty4: Math.round(yScale(ohlc.low)),\n\t\t\t\t},\n\t\t\t\theight: height,\n\t\t\t\twidth: trueOffset * 2,\n\t\t\t\tclassName: className(ohlc),\n\t\t\t\tfill: fill(ohlc),\n\t\t\t\tstroke: stroke(ohlc),\n\t\t\t\tdirection: (ohlc.close - ohlc.open),\n\t\t\t});\n\t\t}\n\t}\n\n\treturn candles;\n}\n\nexport default CandlestickSeries;\n"]}