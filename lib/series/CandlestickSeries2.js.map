{"version":3,"sources":["../../../src/lib/series/CandlestickSeries2.js"],"names":["CandlestickSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","className","wickClassName","candleClassName","xScale","yScale","chartConfig","plotData","xAccessor","candleData","getCandleData","getWicksSVG","getCandlesSVG","clip","propTypes","string","widthRatio","number","width","oneOfType","func","classNames","fill","stroke","wickStroke","yAccessor","bool","defaultProps","open","d","high","low","close","candleStrokeWidth","opacity","wicks","map","each","idx","wick","x","y1","y2","y3","y4","candles","y","height","wickNest","key","entries","lineCap","lineJoin","forEach","outer","values","strokeStyle","fillStyle","fillRect","candleNest","strokeKey","strokeValues","lineWidth","inner","strokeRect","wickStrokeProp","fillProp","strokeProp","widthFunctor","trueOffset","offset","Math","round","floor","i","length","ohlc","max","abs","push","direction"],"mappings":"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","file":"CandlestickSeries2.js","sourcesContent":["\"use strict\";\n\nimport { nest } from \"d3-collection\";\n\nimport React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\n\nimport GenericChartComponent from \"../GenericChartComponent\";\nimport { getAxisCanvas } from \"../GenericComponent\";\n\nimport {\n  hexToRGBA, isDefined, functor, plotDataLengthBarWidth, head\n} from \"../utils\";\n\nclass CandlestickSeries extends Component {\n  constructor(props) {\n    super(props);\n    this.renderSVG = this.renderSVG.bind(this);\n    this.drawOnCanvas = this.drawOnCanvas.bind(this);\n  }\n  drawOnCanvas(ctx, moreProps) {\n    drawOnCanvas(ctx, this.props, moreProps);\n  }\n  renderSVG(moreProps) {\n    const { className, wickClassName, candleClassName } = this.props;\n    const { xScale, chartConfig: { yScale }, plotData, xAccessor } = moreProps;\n\n    const candleData = getCandleData(this.props, xAccessor, xScale, yScale, plotData);\n\n    return <g className={className}>\n      <g className={wickClassName} key=\"wicks\">\n        {getWicksSVG(candleData)}\n      </g>\n      <g className={candleClassName} key=\"candles\">\n        {getCandlesSVG(this.props, candleData)}\n      </g>\n    </g>;\n  }\n\n  render() {\n    const { clip } = this.props;\n    return <GenericChartComponent\n      clip={clip}\n      svgDraw={this.renderSVG}\n      canvasDraw={this.drawOnCanvas}\n      canvasToDraw={getAxisCanvas}\n      drawOn={[\"pan\"]}\n    />;\n  }\n}\n\nCandlestickSeries.propTypes = {\n  className: PropTypes.string,\n  wickClassName: PropTypes.string,\n  candleClassName: PropTypes.string,\n  widthRatio: PropTypes.number,\n  width: PropTypes.oneOfType([\n    PropTypes.number,\n    PropTypes.func\n  ]),\n  classNames: PropTypes.oneOfType([\n    PropTypes.func,\n    PropTypes.string\n  ]),\n  fill: PropTypes.oneOfType([\n    PropTypes.func,\n    PropTypes.string\n  ]),\n  stroke: PropTypes.oneOfType([\n    PropTypes.func,\n    PropTypes.string\n  ]),\n  wickStroke: PropTypes.oneOfType([\n    PropTypes.func,\n    PropTypes.string\n  ]),\n  yAccessor: PropTypes.func,\n  clip: PropTypes.bool,\n};\n\nCandlestickSeries.defaultProps = {\n  className: \"react-stockcharts-candlestick\",\n  wickClassName: \"react-stockcharts-candlestick-wick\",\n  candleClassName: \"react-stockcharts-candlestick-candle\",\n  yAccessor: d => ({ open: d.open, high: d.high, low: d.low, close: d.close }),\n  classNames: d => d.close > d.open ? \"up\" : \"down\",\n  width: plotDataLengthBarWidth,\n  wickStroke: \"#000000\",\n  // wickStroke: d => d.close > d.open ? \"#6BA583\" : \"#FF0000\",\n  fill: d => d.close > d.open ? \"#6BA583\" : \"#FF0000\",\n  // stroke: d => d.close > d.open ? \"#6BA583\" : \"#FF0000\",\n  stroke: \"#000000\",\n  candleStrokeWidth: 0.5,\n  // stroke: \"none\",\n  widthRatio: 0.8,\n  opacity: 0.5,\n  clip: true,\n};\n\nfunction getWicksSVG(candleData) {\n\n  const wicks = candleData\n    .map((each, idx) => {\n      const d = each.wick;\n      return <path key={idx}\n        className={each.className}\n        stroke={d.stroke}\n        d={`M${d.x},${d.y1} L${d.x},${d.y2} M${d.x},${d.y3} L${d.x},${d.y4}`} />;\n    });\n\n  return wicks;\n}\n\nfunction getCandlesSVG(props, candleData) {\n\n  /* eslint-disable react/prop-types */\n  const { opacity, candleStrokeWidth } = props;\n  /* eslint-enable react/prop-types */\n\n  const candles = candleData.map((d, idx) => {\n    if (d.width <= 1)\n      return (\n        <line className={d.className} key={idx}\n          x1={d.x} y1={d.y} x2={d.x} y2={d.y + d.height}\n          stroke={d.fill} />\n      );\n    else if (d.height === 0)\n      return (\n        <line key={idx}\n          x1={d.x} y1={d.y} x2={d.x + d.width} y2={d.y + d.height}\n          stroke={d.fill} />\n      );\n    return (\n      <rect key={idx} className={d.className}\n        fillOpacity={opacity}\n        x={d.x} y={d.y} width={d.width} height={d.height}\n        fill={d.fill} stroke={d.stroke} strokeWidth={candleStrokeWidth} />\n    );\n  });\n  return candles;\n}\n\nfunction drawOnCanvas(ctx, props, moreProps) {\n  const { opacity, candleStrokeWidth } = props;\n  const { xScale, chartConfig: { yScale }, plotData, xAccessor } = moreProps;\n\n  // const wickData = getWickData(props, xAccessor, xScale, yScale, plotData);\n  const candleData = getCandleData(props, xAccessor, xScale, yScale, plotData);\n\n  const wickNest = nest()\n    .key(d => d.wick.stroke)\n    .entries(candleData);\n\n    ctx.lineCap = \"round\";\n    ctx.lineJoin = \"round\";\n\n  wickNest.forEach(outer => {\n    const { key, values } = outer;\n    ctx.strokeStyle = key;\n    ctx.fillStyle = key;\n    values.forEach(each => {\n      /*\n      ctx.moveTo(d.x, d.y1);\n      ctx.lineTo(d.x, d.y2);\n\n      ctx.beginPath();\n      ctx.moveTo(d.x, d.y3);\n      ctx.lineTo(d.x, d.y4);\n      ctx.stroke(); */\n      const d = each.wick;\n\n      ctx.fillRect(d.x - 0.5, d.y1, 1, d.y2 - d.y1);\n      ctx.fillRect(d.x - 0.5, d.y3, 1, d.y4 - d.y3);\n    });\n  });\n\n  // const candleData = getCandleData(props, xAccessor, xScale, yScale, plotData);\n\n  const candleNest = nest()\n    .key(d => d.stroke)\n    .key(d => d.fill)\n    .entries(candleData);\n\n\n  candleNest.forEach(outer => {\n    const { key: strokeKey, values: strokeValues } = outer;\n    if (strokeKey !== \"none\") {\n      ctx.strokeStyle = strokeKey;\n      ctx.lineWidth = candleStrokeWidth;\n    }\n    strokeValues.forEach(inner => {\n      const { key, values } = inner;\n      const fillStyle = head(values).width <= 1\n        ? key\n        : hexToRGBA(key, opacity);\n      ctx.fillStyle = fillStyle;\n\n      values.forEach(d => {\n        if (d.width <= 1) {\n          // <line className={d.className} key={idx} x1={d.x} y1={d.y} x2={d.x} y2={d.y + d.height}/>\n          /*\n          ctx.beginPath();\n          ctx.moveTo(d.x, d.y);\n          ctx.lineTo(d.x, d.y + d.height);\n          ctx.stroke();\n          */\n          ctx.fillRect(d.x - 0.5, d.y, 1, d.height);\n        } else if (d.height === 0) {\n          // <line key={idx} x1={d.x} y1={d.y} x2={d.x + d.width} y2={d.y + d.height} />\n          /*\n          ctx.beginPath();\n          ctx.moveTo(d.x, d.y);\n          ctx.lineTo(d.x + d.width, d.y + d.height);\n          ctx.stroke();\n          */\n          ctx.fillRect(d.x, d.y - 0.5, d.width, 1);\n        } else {\n          /*\n          ctx.beginPath();\n          ctx.rect(d.x, d.y, d.width, d.height);\n          ctx.closePath();\n          ctx.fill();\n          if (strokeKey !== \"none\") ctx.stroke();\n          */\n          ctx.fillRect(d.x, d.y, d.width, d.height);\n          if (strokeKey !== \"none\") ctx.strokeRect(d.x, d.y, d.width, d.height);\n        }\n      });\n    });\n  });\n}\n/*\nfunction getWickData(props, xAccessor, xScale, yScale, plotData) {\n\n  const { classNames: classNameProp, wickStroke: wickStrokeProp, yAccessor } = props;\n  const wickStroke = functor(wickStrokeProp);\n  const className = functor(classNameProp);\n  const wickData = plotData\n      .filter(d => isDefined(yAccessor(d).close))\n      .map(d => {\n        // console.log(yAccessor);\n        const ohlc = yAccessor(d);\n\n        const x = Math.round(xScale(xAccessor(d))),\n          y1 = yScale(ohlc.high),\n          y2 = yScale(Math.max(ohlc.open, ohlc.close)),\n          y3 = yScale(Math.min(ohlc.open, ohlc.close)),\n          y4 = yScale(ohlc.low);\n\n        return {\n          x,\n          y1,\n          y2,\n          y3,\n          y4,\n          className: className(ohlc),\n          direction: (ohlc.close - ohlc.open),\n          stroke: wickStroke(ohlc),\n        };\n      });\n  return wickData;\n}\n*/\n\nfunction getCandleData(props, xAccessor, xScale, yScale, plotData) {\n\n  const { wickStroke: wickStrokeProp } = props;\n  const wickStroke = functor(wickStrokeProp);\n\n  const { classNames, fill: fillProp, stroke: strokeProp, yAccessor } = props;\n  const className = functor(classNames);\n\n  const fill = functor(fillProp);\n  const stroke = functor(strokeProp);\n\n  const widthFunctor = functor(props.width);\n  const width = widthFunctor(props, {\n    xScale,\n    xAccessor,\n    plotData\n  });\n\n  /*\n  const candleWidth = Math.round(width);\n  const offset = Math.round(candleWidth === 1 ? 0 : 0.5 * width);\n  */\n  const trueOffset = 0.5 * width;\n  const offset = trueOffset > 0.7\n    ? Math.round(trueOffset)\n    : Math.floor(trueOffset);\n\n  // eslint-disable-next-line prefer-const\n  let candles = [];\n\n  for (let i = 0; i < plotData.length; i++) {\n    const d = plotData[i];\n    if (isDefined(yAccessor(d).close)) {\n      const x = Math.round(xScale(xAccessor(d)));\n      // const x = Math.round(xScale(xAccessor(d)) - offset);\n\n      const ohlc = yAccessor(d);\n      const y = Math.round(yScale(Math.max(ohlc.open, ohlc.close)));\n      const height = Math.round(Math.abs(yScale(ohlc.open) - yScale(ohlc.close)));\n\n      candles.push({\n        // type: \"line\"\n        x: x - offset,\n        y: y,\n        wick: {\n          stroke: wickStroke(ohlc),\n          x: x,\n          y1: Math.round(yScale(ohlc.high)),\n          y2: y,\n          y3: y + height, // Math.round(yScale(Math.min(ohlc.open, ohlc.close))),\n          y4: Math.round(yScale(ohlc.low)),\n        },\n        height: height,\n        width: offset * 2,\n        className: className(ohlc),\n        fill: fill(ohlc),\n        stroke: stroke(ohlc),\n        direction: (ohlc.close - ohlc.open),\n      });\n    }\n  }\n\n  return candles;\n}\n\nexport default CandlestickSeries;\n"]}